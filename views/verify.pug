extends layout

block style
  link(rel='stylesheet', href='/css/auth.css')
  link(rel='stylesheet', href='/css/modal.css')

block content
  body
    form#verify-form(action='/verify' method='post')
      div
        h1 이메일 인증
        div#modal-admin
          label(for='verification') 인증번호:
          input#verification(type='text' name='verification' required)
        if verifyError
          .error-message= verifyError
        button#verify-button(type='submit' onclick='submitForm(event)') 인증확인
        a#close-modal(href='/join') 돌아가기


    script.
      const urlParams = new URLSearchParams(window.location.search);
      const error = urlParams.get('error');
      if (error === 'verification') {
        alert('인증번호가 일치하지 않습니다.');
      }
    
    script.
        function submitForm(event) {
            event.preventDefault(); // 폼의 기본 동작인 페이지 전환을 막음

            const form = document.getElementById('verify-form');
            const verification = document.getElementById('verification').value;

            // 폼 데이터를 FormData로 생성
            const formData = new FormData(form);
            formData.append('verification', verification);

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/verify');
            xhr.onload = function () {
                if (xhr.status === 200) {
                    window.location.href = '/'; // 인증 성공 시 메인 페이지로 이동
                } else {
                    console.error('Error:', xhr.responseText);
                }
            };
            xhr.onerror = function () {
                console.error('Request failed');
            };
            xhr.send(formData);
        }